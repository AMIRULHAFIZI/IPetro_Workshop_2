{% if current_user.role.role_name == 'Admin' %}
    {% extends 'base_admin.html' %}
{% elif current_user.role.role_name == 'Manager' %}
    {% extends 'base_manager.html' %}
{% else %}
    {% extends 'base.html' %} 
{% endif %}


{% block title %}My Profile - {{ super() }}{% endblock %}

{% block content %}

<!-- Flash Message Display -->
<div class="max-w-xl mx-auto mb-6">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% set category_class = 'bg-blue-100 border-blue-400 text-blue-700' %}
                {% if category == 'success' %}
                    {% set category_class = 'bg-green-100 border-green-400 text-green-700' %}
                {% elif category == 'error' %}
                    {% set category_class = 'bg-red-100 border-red-400 text-red-700' %}
                {% endif %}
                <div class="{{ category_class }} border px-4 py-3 rounded-lg relative mb-3" role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</div>

<div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-md">
    
    <h1 class="text-2xl font-bold text-gray-800 mb-6">
        Personal Information
    </h1>

    <!-- Section 1: Non-Editable User Details -->
    <div class="space-y-4 mb-6 pb-6 border-b border-gray-200">
        <div>
            <label class="block text-sm font-medium text-gray-500">Role</label>
            <p class="text-lg text-gray-800">{{ current_user.role.role_name }}</p>
        </div>
    </div>

    <!-- Section 2: Editable Profile Form -->
    <h2 class="text-xl font-semibold text-gray-800 mb-4">
        Update Information
    </h2>
    <form action="{{ url_for('personal_info') }}" method="POST" class="space-y-6">
        
        {{ form.hidden_tag() }}

        <!-- Username -->
        <div>
            <label for="username" class="block text-sm font-medium text-gray-700 mb-1">
                {{ form.username.label }}
            </label>
            {{ form.username(
                class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            )}}
        </div>

        <!-- Full Name -->
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
                {{ form.name.label }}
            </label>
            {{ form.name(
                class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            )}}
        </div>

        <!-- Email -->
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
                {{ form.email.label }}
            </label>
            {{ form.email(
                class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            )}}
        </div>
        
        <!-- Phone Number -->
        <div>
            <label for="phone_num" class="block text-sm font-medium text-gray-700 mb-1">
                {{ form.phone_num.label }} (Optional)
            </label>
            {{ form.phone_num(
                class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                placeholder="e.g., +60123456789"
            )}}
        </div>

        <!-- Submit Button -->
        <div>
            {{ form.submit(
                class="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md
                       hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                       transition duration-150 ease-in-out cursor-pointer"
            )}}
        </div>
    </form>
</div>
{% endblock %}